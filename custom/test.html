<!DOCTYPE html>
<html>

<head>
    <title>Test Table</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <link rel="stylesheet" href="http://static.tumblr.com/e6lc7yi/z3pnekdqv/precrafted-social.css">
    <link rel="stylesheet" href="http://static.tumblr.com/e6lc7yi/g6Fnsuud3/fixie-styles.css">
    <!--bootstrap and drawer css-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-drawer/1.0.6/css/bootstrap-drawer.min.css">
</head>
<style type="text/css">
@import url(http://fonts.googleapis.com/earlyaccess/notosanstc.css);
html {
    overflow-y: hidden;
}

body {
    background-color: #e6e6e6;
    font-family: 'Noto Sans TC', sans-serif;
}

h2 {
    font-size: 20px;
    text-transform: inherit;
}

a,
a:hover {
    text-decoration: none;
}

.desktop {
    display: initial;
}

.mobile {
    display: none;
}


/* navigation */

header div.center {
    padding-top: 0px;
    padding-left: 0px;
    padding-bottom: : 0px;
}

header .center .centered {
    display: block;
    height: 100vh;
    overflow: hidden;
    background-color: #fff;
}

header p.description {
    margin: 0px;
}

header .logo h1 {
    text-transform: none;
}

header .logo h1 a {
    font-weight: 300;
    color: #000;
}


/* navigation */

#navigation ul li {
    border-top: 2px #ddd solid;
    width: 90%;
    margin: 0px auto;
    font-size: 100%;
    line-height: 1.5em;
    font-weight: 400;
    text-align: left;
    list-style: none;
}

#navigation ul li:hover {
    background: #e5e5e4;
}

#navigation ul li div {
    padding-left: 15%;
    padding-bottom: 10px;
    padding-top: 10px;
    color: #000;
}

#navigation .label-chinese {
    display: inline-block;
    letter-spacing: 1px;
    width: 45%;
}

#navigation .label-english {
    display: inline;
    letter-spacing: 1px;
    font-size: 80%;
    width: 40%;
}

#shortcut {
    padding: 20px;
}

.social_network {
    margin-top: 20px;
}

.social_network a {
    margin: 0px 3px;
}

.social_network img {
    display: inline;
    height: 35px;
    width: auto;
}

.youtube {
    position: relative;
}

.youtube:hover .original img,
.youtube:hover .business img {
    display: block;
}

.business img,
.original img {
    position: absolute;
    left: 35px;
    display: none;
}

.original img {
    top: -25px;
}

.business img {
    top: 10px;
}


/* article */

section {
    margin-bottom: 0px;
    padding: 5px 0px;
}

img.shortcut {
    width: 100%;
}

.grid {
    margin-top: 0px;
}

.single-post article {
    margin-top: 0px;
}

article,
.grid-item {
    width: 33.33%;
}

.single-post article {
    width: 100%;
    margin-bottom: 0px;
}

.grid-item {
    background-color: #fff;
    padding: 40px;
    border: 2px #e6e6e6 solid;
}

.article_content iframe {
    width: 100%;
}

.video-container iframe {
    width: 100%;
    height: auto;
}

.single-post article {
    margin-top: 0px;
}

#youtube_iframe {
    max-height: 460px;
}

.readmore {
    display: block;
}

u {
    text-decoration: underline;
}


/* top */

.top.mobile,
.top.desktop {
    width: 100%;
}

table.top {
    width: 100%;
}

.top td {
    background-color: #fff;
    border-left: 0px solid #e6e6e6;
    border-right: 0px solid #e6e6e6;
    border-bottom: 2px solid #e6e6e6;
    padding: 15px 10px;
}

.top tr:nth-child(1) td:nth-child(1) {
    border-right: 4px solid #e6e6e6;
    border-left: 2px solid #e6e6e6;
}

.top td img {
    width: 100%;
    height: auto
}

.top .top-post {
    background: #fff;
    padding: 20px;
    margin: 5px 2px;
}


/* article */

#fixed-posts {
    display: flex;
}

.article {
    border: 2px solid #e6e6e6;
    padding: 20px;
    background-color: #fff;
    overflow-y: hidden;
    max-height: 100%;
    width: 25%;
    text-align: center;
}

.article.select {
    width: 50%;
}

.article img {
    margin: 0px auto;
    max-height: 100%;
    max-width: 100%;
}


/* tooltip */

.tooltip {
    position: absolute;
    width: 140px;
}

.tooltip-inner {
    font-size: 12px;
    letter-spacing: 2px;
}


/* ---- grid ---- */

.grid {
    background: #E6E6E6;
}


/* clearfix */

.grid:after {
    content: '';
    display: block;
    clear: both;
}


/* ---- grid-item ---- */

.grid-sizer,
.grid-item {
    width: 33.33%;
}

.grid-item {
    float: left;
}


/* image preview */

#image-preview {
    position: fixed;
    width: 100%;
    height: 100vh;
    left: 0;
    right: 0;
    margin: 0px auto;
    text-align: center;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 3;
}

.arrow-left,
.arrow-right,
.preview-close {
    color: #fff;
    font-size: 1.5em;
    cursor: pointer;
    margin: 0px 20px;
}

.arrow-left,
.arrow-right,
.preview-close:hover {}

.middle-table {
    display: table;
    vertical-align: middle;
    width: 100%;
    height: 100vh;
}

.table-field {
    display: table-cell;
    vertical-align: middle;
}

.preview-close {
    margin: 20px 0px;
}

#image-preview img,
.arrow-left,
.arrow-right {
    display: inline;
    max-height: 80vh;
    max-width: 60%;
}

@media only screen and (min-width: 1800px) {
    .grid-sizer,
    .grid-item {
        width: 25%;
    }
    .double_size {
        width: 50%;
    }
    .article {
        width: 25%;
        padding: 20px;
    }
    .article.select {
        width: 50%;
    }
}

@media only screen and (max-width: 1800px) {
    .grid-sizer,
    .grid-item {
        width: 33.33%;
    }
    .double_size {
        width: 33.33%;
    }
    .article {
        width: 25%;
        padding: 25px;
    }
    .article.select {
        width: 50%;
    }
}

@media only screen and (max-width: 1420px) {
    .grid-sizer,
    .grid-item {
        width: 50%;
    }
    .double_size {
        width: 100%;
    }
    .article {
        width: 25%;
        padding: 25px;
    }
    .article.select {
        width: 50%;
    }
}

@media only screen and (max-width: 1080px) {
    html {
        overflow-y: auto;
    }
    .desktop table.top {
        display: none;
    }
    div.top.mobile {
        display: initial;
    }
    #fixed-posts{
        display: block;
    }
    .article {
        width: 50%;
        padding: 10px;
        float: left;
    }
    .article.select {
        width: 100%;
    }
}

@media only screen and (max-width: 1024px) {
    .grid-sizer,
    .grid-item {
        width: 100%;
    }
    header,
    div.center {
        width: 40%;
    }
    section {
        width: 60%;
    }
    .desktop table.top {
        display: none;
    }
    div.top.mobile {
        display: initial;
    }
}

@media only screen and (max-width: 768px) {
    .desktop {
        display: none;
    }
    .mobile {
        display: initial;
    }
    .grid-sizer,
    .grid-item {
        width: 100%;
        padding: 20px;
    }
    div.center {
        width: 100%;
        height: 100vh;
    }
    .drawer {
        max-width: 400px;
    }
    /* container header */
    .container {
        padding-left: 0px;
        padding-right: 0px;
        background-color: #e3e3e3;
        width: 100%;
    }
    #header {
        background-color: #fff;
        display: table;
        padding: 0px 0px;
        height: 40px;
        width: 100%;
        position: fixed;
        top: 0px;
        z-index: 2;
        border-bottom: 1px solid #E6E6E6;
    }
    #header .drawer_icon {
        display: table-cell;
        vertical-align: middle;
        text-align: center;
        padding: 0px 0px;
        border-right: 1px solid #E6E6E6;
        width: 15%;
    }
    #header .drawer_icon img {
        margin: 0px auto;
    }
    #header .title {
        display: table-cell;
        text-align: center;
        color: #8D8D8D;
        text-transform: uppercase;
        vertical-align: middle;
        width: 70%;
        font-size: 150%;
    }
    #header .find-us {
        display: table-cell;
        vertical-align: middle;
        height: inherit;
        height: 40px;
        width: auto;
        text-align: right;
    }
    #header .find-us a,
    #header .find-us img {
        height: 100%;
        width: auto;
        margin: 0px auto;
    }
    /* drawer */
    .drawer-body {
        padding: 0px;
    }
    .center {
        padding-top: 0px;
        padding-left: 0px;
        background-color: #fff;
        text-align: center;
    }
    .drawer-controls {
        height: 45px;
    }
    /* shortcut */
    #shortcut {
        background-color: #fff;
        padding: 10px;
        border-radius: 10px 10px 50px 10px;
    }
    .avatar {
        width: 40%;
        margin: 5% auto;
    }
    .avatar img {
        width: 100%;
    }
    .avatar.circle img {
        border-radius: 100%;
    }
    .avatar img {
        overflow: hidden;
        display: inline-block;
    }
    .logo a {
        color: #767676;
        text-decoration: none;
    }
    .logo h1 a {
        font-size: 65%;
        font-weight: 300;
    }
    p.description {
        margin: 0px;
        font-size: 45%;
    }
    /* Navigation */
    #navigation ul {
        background: #fff;
    }
    #navigation ul li {
        border-top: 2px #ddd solid;
        width: 90%;
        margin: 0px auto;
        padding-top: 3%;
        padding-bottom: 3%;
        font-size: 100%;
        line-height: 1.5em;
        font-weight: 400;
        text-align: left;
        list-style: none;
    }
    #navigation ul li:hover {
        background: #e5e5e4;
    }
    #navigation ul li div {
        padding-left: 15%;
        color: #000;
    }
    #navigation .label-chinese {
        display: inline-block;
        letter-spacing: 1px;
        width: 45%;
    }
    #navigation .label-english {
        display: inline;
        letter-spacing: 1px;
        font-size: 80%;
        width: 40%;
    }
    .social_network {
        background: #fff;
        padding: 10px;
    }
    .social_network img {
        display: inline;
        width: auto;
        margin: 0px 5px;
        width: auto;
    }
    /* section */
    section {
        margin-top: 0px;
        margin-bottom: 0px;
        float: none;
        width: 100%;
        padding: 10px;
    }
    /* top */
    .top .top-post img {
        width: 100%;
    }
    /* article */
    .caption {
        margin-top: 10px;
    }
    .icons {
        margin: 0px 0px -12px -5px;
    }
    #youtube_iframe {
        max-height: 200px;
    }
    /* mobile */
    .tmblr-iframe--controls.iframe-controls--phone-mobile,
    .tmblr-iframe--mobile-logged-in-controls.iframe-controls--phone-mobile {
        display: none;
    }
    .tmblr-iframe--controls-phone-container {
        padding-top: 0px;
    }
    .mask {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 10;
        display: none;
    }
}
</style>

<body>
    <header class="desktop">
        <div class="center">
            <div class="centered">
                <div id="shortcut">
                    <div class="avatar">
                        <a href="/" title="Woolito Studio" class="avatar circle" rel="external"><img src="http://67.media.tumblr.com/avatar_8aeb4c547c3b_128.png" alt="Woolito Studio" class="default"></a>
                    </div>
                    <div class="logo">
                        <h1><a href="/" rel="external" title="Woolito Studio">Woolito Studio</a></h1></div>
                    <p class="description">我們努力創作有趣的動畫與圖文並分享笑容</p>
                    <p class="description">希望能為彼此的生活點綴</p>
                    <p class="description">一些無厘頭的樂趣！</p>
                    <div class="social_network">
                        <a href="https://www.facebook.com/Woolito/" target="_blank"><img src="http://static.tumblr.com/sirdwhf/Jd6ogz322/facebook.png"></a>
                        <a href="https://page.line.me/woolito" target="_blank"><img src="http://static.tumblr.com/sirdwhf/cQ3ogz32k/line.png"></a>
                        <a href="https://www.instagram.com/woolito_studio/" target="_blank"><img src="http://static.tumblr.com/sirdwhf/WShogz32q/instagram.png"></a><span class="youtube"><a href="#" target="_blank"><img src="http://static.tumblr.com/sirdwhf/l4Uogz32f/youtube.png"></a><a href="#" target="_blank" class="original"><img src="http://static.tumblr.com/sirdwhf/YiHogz333/original.png"></a><a href="#" target="_blank" class="business"><img src="http://static.tumblr.com/sirdwhf/v0iogz32z/business.png"></a></span></div>
                </div>
                <div id="navigation">
                    <ul>
                        <li>
                            <a href="/contact">
                                <div><span class="label-chinese">聯繫我們</span><span class="label-english">Contact</span></div>
                            </a>
                        </li>
                        <li>
                            <a href="/aboutus">
                                <div><span class="label-chinese">關於我們</span><span class="label-english">About Woolito</span></div>
                            </a>
                        </li>
                        <li>
                            <a href="/service">
                                <div><span class="label-chinese">商業服務</span><span class="label-english">Service</span></div>
                            </a>
                        </li>
                        <li>
                            <a href="/works">
                                <div><span class="label-chinese">作品集</span><span class="label-english">Works</span></div>
                            </a>
                        </li>
                        <li>
                            <a href="http://woolito.shoplineapp.com/" target="_blank">
                                <div><span class="label-chinese">原創商品</span><span class="label-english">Shop</span></div>
                            </a>
                        </li>
                        <li>
                            <a href="https://store.line.me/stickershop/author/72619" target="_blank">
                                <div><span class="label-chinese">LINE 貼圖</span><span class="label-english">LINE Sticker</span></div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <section class="the-posts index desktop">
        <table class="top" id="top">
            <tbody>
                <tr>
                    <td rowspan="3">
                        <a href="works" rel="external"><img src="http://static.tumblr.com/sirdwhf/469oflb8k/top-works.png"></a>
                    </td>
                    <td>
                        <a href="aboutus" rel="external"><img src="http://static.tumblr.com/sirdwhf/Tp1oflb8t/top-about.png"></a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <a href="service" rel="external"><img src="http://static.tumblr.com/sirdwhf/rICog6032/top-service.png"></a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <a href="contact" rel="external"><img src="http://static.tumblr.com/sirdwhf/hzwoflb9f/top-contact.png"></a>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="top mobile">
            <div class="top-post">
                <a href="works-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/469oflb8k/top-works.png"></a>
            </div>
            <div class="top-post">
                <a href="aboutus-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/Tp1oflb8t/top-about.png"></a>
            </div>
            <div class="top-post">
                <a href="service-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/rICog6032/top-service.png"></a>
            </div>
            <div class="top-post">
                <a href="contact-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/hzwoflb9f/top-contact.png"></a>
            </div>
        </div>
        <div id="fixed-posts">
        </div>
    </section>
    <div class="mobile has-drawer">
        <div id="drawerExample" class="drawer dw-xs-10 dw-sm-6 dw-md-4 fold" aria-labelledby="drawerExample">
            <div class="drawer-contents">
                <div class="drawer-body">
                    <div class="center">
                        <div class="centered">
                            <div id="shortcut">
                                <div class="avatar">
                                    <a href="/" title="Woolito Studio" class="avatar circle" rel="external"><img src="http://67.media.tumblr.com/avatar_fbc2eabcb706_128.png" alt="Woolito Studio" class="default"></a>
                                </div>
                                <div class="logo">
                                    <h1><a href="/" rel="external" title="Woolito Studio">Woolito Studio</a></h1></div>
                                <p class="description">我們努力創作有趣的動畫與圖文並分享笑容</p>
                                <p class="description">希望能為彼此的生活點綴</p>
                                <p class="description">一些無厘頭的樂趣！</p>
                            </div>
                            <div id="navigation">
                                <ul>
                                    <li>
                                        <a href="/contact">
                                            <div><span class="label-chinese">聯繫我們</span><span class="label-english">Contact</span></div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/aboutus">
                                            <div><span class="label-chinese">關於我們</span><span class="label-english">About Woolito</span></div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/service">
                                            <div><span class="label-chinese">商業服務</span><span class="label-english">Service</span></div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/works">
                                            <div><span class="label-chinese">作品集</span><span class="label-english">Works</span></div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="http://woolito.shoplineapp.com/" target="_blank">
                                            <div><span class="label-chinese">原創商品</span><span class="label-english">Shop</span></div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://store.line.me/stickershop/author/72619" target="_blank">
                                            <div><span class="label-chinese">LINE 貼圖</span><span class="label-english">LINE Sticker</span></div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="social_network">
                                <a href="https://www.facebook.com/Woolito/" target="_blank"><img src="http://static.tumblr.com/sirdwhf/Jd6ogz322/facebook.png"></a>
                                <a href="https://page.line.me/woolito" target="_blank"><img src="http://static.tumblr.com/sirdwhf/cQ3ogz32k/line.png"></a>
                                <a href="https://www.instagram.com/woolito_studio/" target="_blank"><img src="http://static.tumblr.com/sirdwhf/WShogz32q/instagram.png"></a>
                                <a href="https://www.youtube.com/user/WoolitoFilm" target="_blank"><img src="http://static.tumblr.com/sirdwhf/l4Uogz32f/youtube.png"></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div id="header">
                <div class="drawer_icon"><img src="http://static.tumblr.com/sirdwhf/6PVobwmdh/drawer.png"></div>
                <div class="title">Woolito Studio</div>
                <div class="find-us">
                    <a href="/contact-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/V2Lof6jne/find_us.png"></a>
                </div>
            </div>
            <section class="the-posts index">
                <div class="top">
                    <div class="top-post">
                        <a href="works-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/469oflb8k/top-works.png"></a>
                    </div>
                    <div class="top-post">
                        <a href="aboutus-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/Tp1oflb8t/top-about.png"></a>
                    </div>
                    <div class="top-post">
                        <a href="service-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/rICog6032/top-service.png"></a>
                    </div>
                    <div class="top-post">
                        <a href="contact-mobile" rel="external"><img src="http://static.tumblr.com/sirdwhf/hzwoflb9f/top-contact.png"></a>
                    </div>
                </div>
                <div class="grid" id="fixed-posts-mobile"></div>
            </section>
        </div>
        <div class="mask"></div>
    </div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript">
var posts = {};
var images = [];

$(function() {
    console.log("width: " + $(window).width());
    console.log("user agent: " + navigator.userAgent);

    var path = location.pathname;
    var isSinglePage = (path.indexOf("/post/") > -1);

    fixSinglePostPage();

    if (!isSinglePage) {
        query_all_posts();
    }
});

function ismobile() {
    if (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i) || navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Windows Phone/i)) {
        return true;
    } else {
        return false;
    }
}

function ismobile_size() {
    var width = $(window).width();
    var href = location.href;
    var index = href.lastIndexOf("/") + 1;
    href = href.substring(index);
    if (width <= 768) {
        return true;
    } else {
        return false;
    }
}

function fixHeight() {
    var articles = document.getElementById("fixed-posts");
    var topHeight = document.getElementById("top").offsetHeight;
    var windowHeight = document.body.clientHeight;
    var maxHeight = windowHeight - topHeight - 10;
    articles.style.maxHeight = maxHeight + "px";
    var selectArticles = document.getElementsByClassName("select");
    console.log(maxHeight);
}

function query_all_posts() {
    var key = "zcBf3tONWu9lQTSzrewHYU3WRdgbv1VtPGHXXMaZlZgN6Sz0lc";
    var home_posts = [];
    var select_posts = [];

    $.ajax({
        url: "http://api.tumblr.com/v2/blog/woolito.tumblr.com/posts",
        type: "GET",
        dataType: 'jsonp',
        data: {
            api_key: key
        }
    }).done(function(data) {
        var data_json = data.response.posts;
        for (var i = 0; i < data_json.length; i++) {
            try {
                tags = data_json[i].tags;
                if (tags == undefined) {
                    tags = [];
                };
                if (tags.indexOf("home_only") > -1) {
                    if (tags.indexOf("top") > -1) {
                        home_posts.unshift(data_json[i]);
                    } else {
                        home_posts.push(data_json[i]);
                    }
                } else if (tags.indexOf("select") > -1) {
                    select_posts.push(data_json[i]);
                }
            } catch (err) {
                console.log(err);
                continue;
            }
        }
        posts.home = home_posts;
        posts.select = select_posts;

        render_posts();
        if (window.innerWidth > 1080) {
            fixHeight();
        }
    });
}

function render_posts() {
    var post_element;
    var desktopOrder = ["home", "select"];
    var mobileOrder = ["select", "home"];
    var order = desktopOrder;
    var articles = document.getElementById("fixed-posts");
    if (window.innerWidth < 1080 && window.innerWidth > 768) {
        order = mobileOrder;
    } else if (window.innerWidth <= 768) {
        articles = document.getElementById("fixed-posts-mobile");
        order = mobileOrder;
    }

    for (var i = 0; i < order.length; i++) {
        var posts_array = posts[order[i]];
        console.log(posts[order[i]]);
        for (var j = 0; j < posts_array.length; j++) {
            switch (order[i]) {
                case "home":
                    post_element = render_home(posts_array[j]);
                case "select":
                    post_element = render_select(posts_array[j]);
                default:
                    break;
            }
            articles.appendChild(post_element);
        }
    }
}

function render_home(post) {
    var article = document.createElement("div");
    article.setAttribute("id", post.id);
    article.setAttribute("rel", post.post_url);
    article.className = "article";
    var tags = post.tags;
    for (var i = 0; i < tags.length; i++) {
        article.className += " " + tags[i];
    }
    var articleLink = document.createElement("a");
    articleLink.setAttribute("href", post.link_url);
    var articleImage = document.createElement("img");
    articleImage.setAttribute("src", post.photos[0].original_size.url);
    articleLink.appendChild(articleImage);
    article.appendChild(articleLink);
    return article;
}

function render_select(post) {
    var article = document.createElement("div");
    article.setAttribute("id", post.id);
    article.setAttribute("rel", post.post_url);
    article.className = "article";
    var tags = post.tags;
    for (var i = 0; i < tags.length; i++) {
        article.className += " " + tags[i];
    }
    var articleLink = document.createElement("a");
    articleLink.setAttribute("href", post.link_url);
    var articleImage = document.createElement("img");
    articleImage.setAttribute("src", post.photos[0].original_size.url);
    articleLink.appendChild(articleImage);
    article.appendChild(articleLink);
    return article;
}

function analysis_caption_iframe(caption, post_id) {
    if (!(caption.indexOf("youtube_iframe") > -1)) {
        return caption;
    }
    var patt = /https:\/\/www.youtube.com\/embed\/(\w+)\?/i;
    var patt2 = /<figure(.*)>(.*)<\/figure>/i;
    var youtube_id = caption.match(patt)[1];
    var link_element = $('<a target="_blank"></a>');
    link_element.attr("href", "http://woolito.tumblr.com/post/" + post_id + "/");
    var shortcut_element = $("<img >");
    shortcut_element.addClass("shortcut");
    shortcut_element.attr("src", "https://i.ytimg.com/vi/" + youtube_id + "/hqdefault.jpg");
    shortcut_element.attr("youtube_id", youtube_id);
    shortcut_element.attr("data-toggle", "tooltip");
    shortcut_element.attr("data-placement", "bottom");
    shortcut_element.attr("title", "點擊觀看作品介紹");
    link_element.html(shortcut_element);
    link_element = link_element.prop('outerHTML');

    caption = caption.replace(patt2, link_element);
    return caption;
}

function fixMobile() {
    $(".desktop").css("display", "none");
    // $(".mobile").css("display", "block");
}

function fixSinglePostPage() {
    var path = location.pathname;
    if (!(path.indexOf("/post/") > -1)) {
        return;
    }

    // attach lightbox event on img
    getImages();
    $(".article-content img").click(function(event) {
        event.preventDefault();
        showImagePreview(event);
    });

    // fix html no scroll bar
    document.documentElement.style.height = "120vh";
    document.documentElement.style.overflowY = "auto";
}

function getImages() {
    var articleContent = $(".article-content");
    var imagesJquery = articleContent.find("img");
    for (var i = 0; i < imagesJquery.length; i++) {
        var image = {};
        var imageJquery = $(imagesJquery[i]);
        image.src = imageJquery.attr("src");
        images.push(image);
    }
}

function showImagePreview(event) {
    var target = event.currentTarget;
    var currentSrc = target.currentSrc;
    var index = findObjectIndex(images, currentSrc);
    previewCurrenImage = index;

    var preview = document.createElement("div");
    preview.setAttribute("id", "image-preview");
    var middleTable = document.createElement("div");
    middleTable.className = "middle-table";
    middleTable.addEventListener("click", function() {
        try {
            preview.parentElement.removeChild(preview);
        } catch (err) {}
    });
    var tableField = document.createElement("div");
    tableField.className = "table-field";
    var arrowLeft = document.createElement("span");
    arrowLeft.setAttribute("id", "arrow-left");
    arrowLeft.className = "arrow-left glyphicon glyphicon-chevron-left";
    if (index <= 0) {
        arrowLeft.style.display = "none";
    }
    arrowLeft.addEventListener("click", function(event) {
        event.stopPropagation();
        preImage();
    });
    var imageElement = document.createElement("img");
    imageElement.setAttribute("id", "preview-image");
    imageElement.setAttribute("src", currentSrc);
    imageElement.addEventListener("click", function(event) {
        event.stopPropagation();
        nextImage();
    });
    var arrowRight = document.createElement("span");
    arrowRight.setAttribute("id", "arrow-right");
    arrowRight.className = "arrow-right glyphicon glyphicon-chevron-right";
    if (index >= images.length - 1) {
        arrowRight.style.display = "none";
    }
    arrowRight.addEventListener("click", function(event) {
        event.stopPropagation();
        nextImage();
    });
    var close = document.createElement("div");
    close.className = "preview-close";
    var closeIcon = document.createElement("span");
    closeIcon.className = "glyphicon glyphicon-remove";
    close.addEventListener("click", function() {
        try {
            preview.parentElement.removeChild(preview);
        } catch (err) {}
    });

    close.appendChild(closeIcon);
    tableField.appendChild(arrowLeft);
    tableField.appendChild(imageElement);
    tableField.appendChild(arrowRight);
    middleTable.appendChild(tableField).appendChild(close);
    preview.appendChild(middleTable);

    document.body.appendChild(preview);
    document.addEventListener("keydown", function(event) {
        var keyCode = event.keyCode;
        switch (keyCode) {
            case 27:
                try {
                    preview.parentElement.removeChild(preview);
                } catch (err) {}
                break;
            case 37:
                preImage();
                break;
            case 39:
                nextImage();
                break;
        }
    }, false);
}

function findObjectIndex(array, value) {
    for (var i = 0; i < array.length; i++) {
        if (array[i].src == value) {
            return i;
        }
    }
    return null;
}

function preImage() {
    if (previewCurrenImage > 0) {
        previewCurrenImage--;
    } else {
        // 已經是第一張圖片
    }
    var previewImage = document.getElementById("preview-image");
    previewImage.setAttribute("src", images[previewCurrenImage].src);
    if (previewCurrenImage <= 0) {
        document.getElementById("arrow-left").style.display = "none";
    }
    document.getElementById("arrow-right").style.display = "initial";
}

function nextImage(index) {
    if (previewCurrenImage < images.length - 1) {
        previewCurrenImage++;
    } else {
        // 已經是最後一張圖片
    }
    var previewImage = document.getElementById("preview-image");
    previewImage.setAttribute("src", images[previewCurrenImage].src);
    if (previewCurrenImage >= images.length - 1) {
        document.getElementById("arrow-right").style.display = "none";
    }
    document.getElementById("arrow-left").style.display = "initial";
}
</script>

</html>
